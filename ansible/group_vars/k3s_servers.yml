# K3s Cluster Configuration
# HA cluster with External PostgreSQL Datastore + Kube-VIP

# K3s Version Channel (auto-updates within this minor version)
k3s_channel: "v1.30"

# External PostgreSQL Datastore (Optimization: no embedded etcd)
datastore_endpoint: "postgres://k3s_master:{{ vault_k3s_db_password | default('21042004') }}@{{ service_ips.postgres }}:5432/k3s"

# Kube-VIP Configuration (HA Control Plane)
vip_address: "{{ service_ips.k3s_vip }}"
vip_interface: "ens36"  # Will be auto-detected

# K3s Server Arguments
extra_server_args:
  - "--tls-san {{ vip_address }}"
  - "--tls-san k3s.tantai.dev"
  - "--kube-apiserver-arg default-not-ready-toleration-seconds=30"
  - "--kube-apiserver-arg default-unreachable-toleration-seconds=30"
  - "--disable traefik"
  - "--disable servicelb"

# Shared token for cluster join
k3s_token: "{{ vault_k3s_token | default('21042004') }}"
