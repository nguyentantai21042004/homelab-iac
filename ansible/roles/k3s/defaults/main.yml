---
# K3s role defaults

# K3s Version Channel (auto-updates within this minor version)
k3s_channel: "v1.34"

# Kube-VIP Configuration (HA Control Plane)
vip_address: "172.16.21.100"
vip_interface: "ens36"

# K3s Server Arguments
extra_server_args:
  - "--tls-san {{ vip_address }}"
  - "--tls-san k3s.tantai.dev"
  - "--kube-apiserver-arg default-not-ready-toleration-seconds=30"
  - "--kube-apiserver-arg default-unreachable-toleration-seconds=30"

# Shared token for cluster join (should be overridden via vault)
k3s_token: "{{ vault_k3s_token | default('ChangeMeInProduction!') }}"

# External PostgreSQL Datastore
datastore_endpoint: "postgres://k3s_master:{{ vault_k3s_db_password }}@{{ service_ips.postgres | default('172.16.19.10') }}:5432/k3s"

# Kernel modules required by K3s
k3s_kernel_modules:
  - br_netfilter
  - overlay

# Sysctl parameters for K3s networking
k3s_sysctl_params:
  - net.bridge.bridge-nf-call-iptables
  - net.bridge.bridge-nf-call-ip6tables
  - net.ipv4.ip_forward

# K3s manifests directory
k3s_manifests_dir: "/var/lib/rancher/k3s/server/manifests"

# K3s config path (used to check if already installed)
k3s_config_path: "/etc/rancher/k3s/k3s.yaml"

# Timeouts
k3s_install_timeout: 120
k3s_node_ready_retries: 30
k3s_node_ready_delay: 10
