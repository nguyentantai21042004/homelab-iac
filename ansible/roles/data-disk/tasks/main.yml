---
# Role: data-disk
# Format and mount a data disk with idempotent checks
# Requirements: 3.1, 3.2, 3.3, 3.4, 11.1

- name: Check if data disk is formatted
  command: blkid {{ data_disk_device }}
  register: blkid_result
  failed_when: false
  changed_when: false

- name: Format data disk with {{ disk_fstype }}
  filesystem:
    fstype: "{{ disk_fstype }}"
    dev: "{{ data_disk_device }}"
  when: blkid_result.rc != 0

- name: Create mount point
  file:
    path: "{{ data_mount_point }}"
    state: directory
    mode: "0755"

- name: Mount data disk
  mount:
    path: "{{ data_mount_point }}"
    src: "{{ data_disk_device }}"
    fstype: "{{ disk_fstype }}"
    opts: "{{ disk_mount_opts }}"
    state: mounted
