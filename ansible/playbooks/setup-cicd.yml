---
# Playbook: Setup Woodpecker CI
# Optimal CI/CD with DooD (Docker-outside-of-Docker) architecture
# Prerequisites: Run setup-vm.yml first to configure hostname, static IP, and mount data disk

- name: Setup Woodpecker CI
  hosts: cicd_servers
  become: true
  roles:
    - role: docker
      vars:
        docker_daemon_config:
          data-root: "/mnt/data/docker"
          storage-driver: overlay2
          log-driver: json-file
          log-opts:
            max-size: "50m"
            max-file: "3"
          insecure-registries:
            - "{{ zot_registry_ip }}:{{ zot_registry_port }}"
    - role: woodpecker
